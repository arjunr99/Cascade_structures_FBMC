clear all;
close all;
clc;

fun = @solv5;
options = optimoptions('fsolve','Display','iter');
options.MaxFunEvals = 14400*2;
options.MaxIter = 2000;
options.TolFun = 1e-10;
%options.TolX = 1e-10;

%v0 = [1.59108916471774,1.15777978176223,0.890966236417880,0.789519406851903,0.956002202646729,-0.0881036722361248,1.33237967007304,1.47511056636684,1.11646028734456,0.920999654959786,1.94903113360904,0.314074306959796,0.644931463384187,0.842557996795151,1.04609315871002,0.919778781436890,1.84883191046812,0.931183040266172,0.779244845274762,0.855892471313016,0.873923383284836,0.358350036773449,1.55346115191955,1.15559392951375,1.14022439041977,1.14441500334160,1.49343370181445,0.619746177955955,0.888046112582995,0.969182424556915,1.14090311610359,0.900161697267018,1.52765770748851,0.913674337334557,1.00746426143006,0.752820793345429,1.06621311450856,0.918608980434653,1.27774754840107,1.30175065341119,1.47454750856246,1.20334348423651,1.27788138556094,0.471972741266642,0.334841121948131,ones(1,102)];
v0 = [1.39191400059026,1.08069099176327,0.933479046315096,0.992387982488910,1.13110511555778,0.0205859532921851,1.53385616502078,1.47527607583291,1.02253969258169,0.711741172171034,1.90280257281884,-0.0506484276230468,0.450817728472811,0.964952024929016,1.17258315248684,1.03358498148576,1.82346756460033,0.801664864140341,0.700104420501679,0.988031637715599,0.689292142600737,0.384577808207178,1.64551575506697,1.35818332376203,0.889470374075322,1.22133877567743,1.45722418560041,0.443685238011762,0.783160161525017,1.12488139892925,1.19957662556855,0.923761562736721,1.46622329486659,1.00142150086001,0.955535231637311,0.811767556344698,1.20156163497941,0.834672580979136,1.30626060114112,1.17955078129727,1.40865284501476,0.993522695356812,1.23988459674742,0.590683624441571,0.888849998197741,0.668066976950139,1.04711548726243,0.800796274892817,1.34171539463662,1.04224848807173,1.19776643803863,0.984532439947559,1.16541476360715,0.648626443790755,0.953395924893613,0.936650320136539,1.05421794396070,0.861278802778289,1.17976813924212,0.953334743443178,0.952670838206769,0.986349975933880,1.14853470395483,0.829462580770611,1.06303306189506,1.12215504445502,1.05785320133049,0.867023880709684,1.06418877470964,0.865472157194859,0.797594213868352,0.969566048066092,1.15159370708428,0.898730412474375,1.14020579109462,1.20070012623948,1.05630766136022,0.864973620800021,1.02643710365668,0.806993631685518,0.759660595123326,0.966423370523248,1.13466533374827,0.919374020661486,1.16913365428716,1.16564739002661,1.04667560951001,0.907381405167911,1.02737364971870,0.823084733606615,0.829078950533649,0.984146655104745,1.09136208447150,0.928120204205039,1.14047606886546,1.07038135153366,1.03059465596690,0.967322809258322,1.04146194450129,0.882544276135134,0.917863766320532,1.00344701282621,1.04827766354892,0.926843019061788,1.09452910680865,0.976093884595478,1.01266782467153,1.01314575273422,1.06032354366696,0.935864854645385,0.992897799222236,1.02061329687610,1.01639831411800,0.913967233768797,1.05536024053839,0.888550466842526,0.992285751093520,1.04655931234547,1.08852876798544,0.978799859928428,1.06935109603360,1.04200443450077,0.988622853881574,0.881651718626131,1.01287412189731,0.775612529007183,0.953725533310115,1.07247069810194,1.13590825354855,1.03073772934497,1.19400317771020,1.08945454873916,0.954888835977383,0.801468292064831,0.918676570885077,0.534439732331233,0.825143604326693,1.07416582966406,1.24245890936240,1.19155470450587,1.48034178040318,1.27059563514353,0.941278563968355,0.535372407167949,0.344006743286470,1,1];

v = fsolve(fun,v0,options);

d1 = lt_poly({1; [0, 1]; [0,0,1]; [0,0,0,1]; [0,0,0,0,1]},0);

H0 = 1/5*dftmtx(5);

Y =  H0 * cascade(v)* d1;

a = GetCoefs(Y);

plot(abs(fftshift(fft(a{1},1024))).^2)
figure;
plot(abs(fftshift(fft(a{2},1024))).^2)
figure;
plot(abs(fftshift(fft(a{3},1024))).^2)